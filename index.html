<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Candy Cartel - Sweet Confections</title>
  <style>
    /* ... (your existing styles remain unchanged) ... */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Arial', sans-serif; background: #fff8f0; color: #333; display: flex; flex-direction: column; min-height: 100vh; line-height: 1.6;
    }
    a { text-decoration: none; color: inherit; }
    h1, h2, h3, h4, h5, h6 { margin-bottom: 10px; }
    button {
      cursor: pointer; border: none; border-radius: 5px; background-color: #ff6f61; color: #fff; font-weight: bold; padding: 10px 20px; font-size: 1em; transition: all 0.3s ease;
    }
    button:hover { background-color: #e65b50; transform: scale(1.02); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }

    /* ... (rest of your styles) ... */
    .products-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;
    }
    .product-card {
      background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); overflow: hidden; display: flex; flex-direction: column; align-items: center; padding: 10px; transition: all 0.3s ease;
    }
    /* Removed image styles for clarity since images are no longer used */
    /* ... */
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo-section">
      <img src="https://images.unsplash.com/photo-1549924231-f129b911e442?ixlib=rb-4.0.4&auto=format&fit=crop&w=50&q=80" alt="Candy Logo"/>
      <span class="store-name">Candy Cartel</span>
    </div>
    <div class="nav-buttons">
      <a href="#" data-page="home">Home</a>
      <a href="#" data-page="lollies">Lollies</a>
      <a href="#" data-page="chocolates">Chocolates</a>
      <a href="#" data-page="drinks">Drinks</a>
      <a href="#" data-page="reviews">Reviews</a>
      <div id="cart-container" style="position: relative;">
        <button id="cart-btn" aria-label="Cart">ðŸ›’</button>
        <div id="cart-badge">0</div>
      </div>
    </div>
  </header>

  <div id="content"></div>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>

  <script>
    // =================== JavaScript Modules ===================
    const pages = ['home','lollies','chocolates','drinks','reviews','cart','checkout','contact'];
    let currentPage = 'home';
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let reviews = JSON.parse(localStorage.getItem('reviews')) || [];
    const MAX_ITEMS = 50;

    // =================== Google Maps ===================
    function initMap() {
      const storeLocation = { lat: 34.0522, lng: -118.2437 };
      const map = new google.maps.Map(document.getElementById('map'), {
        zoom: 15,
        center: storeLocation,
      });
      const marker = new google.maps.Marker({
        position: storeLocation,
        map: map,
        title: 'Candy Cartel',
      });
    }

    // Utility functions
    function showNotification(msg) {
      const div = document.createElement('div');
      div.className = 'notification-banner show';
      div.innerText = msg;
      document.body.appendChild(div);
      setTimeout(() => {
        div.className = 'notification-banner hide';
        setTimeout(() => div.remove(), 500);
      }, 2500);
    }

    function updateCartBadge() {
      const total = cart.reduce((sum, i) => sum + i.quantity, 0);
      document.getElementById('cart-badge').innerText = total;
    }

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function loadCart() {
      const s = localStorage.getItem('cart');
      if (s) cart = JSON.parse(s);
    }

    function saveReviews() {
      localStorage.setItem('reviews', JSON.stringify(reviews));
    }

    // Render page based on navigation
    function render(page) {
      currentPage = page;
      document.getElementById('content').innerHTML = '';
      if (page === 'home') renderHomePage();
      else if (page === 'lollies') renderProductsPage('Lollies', generateProducts('Lollies'));
      else if (page === 'chocolates') renderProductsPage('Chocolates', generateProducts('Chocolates'));
      else if (page === 'drinks') renderProductsPage('Drinks', generateProducts('Drinks'));
      else if (page === 'reviews') renderReviewPage();
      else if (page === 'cart') renderCartPage();
      else if (page === 'checkout') renderCheckoutPage();
      else if (page === 'contact') renderContactPage();
    }

    // Generate product data
    function generateProducts(type) {
      const namesMap = {
        'Lollies': ['Rainbow Swirl', 'Strawberry Bliss', 'Gummy Bears', 'Lemon Zest', 'Cherry Pop', 'Fruit Chews', 'Sour Worms', 'Candy Cane'],
        'Chocolates': ['Milk Chocolate Bar', 'Dark Chocolate Truffle', 'Caramel Fudge', 'White Chocolate Mousse', 'Almond Chocolate', 'Hazelnut Kisses', 'Chocolate Bites', 'Cocoa Dreams'],
        'Drinks': ['Cola Classic', 'Lemonade Spark', 'Strawberry Shake', 'Mint Mojito', 'Fruit Punch', 'Cream Soda', 'Iced Tea', 'Grape Fizz'],
        'Chips': ['Salt & Vinegar', 'BBQ Ribs', 'Cheddar Crisps', 'Spicy Jalapeno', 'Sweet Potato', 'Classic Potato', 'Sour Cream & Onion', 'BBQ Blaze']
      };
      const names = namesMap[type] || [`${type} ${Math.ceil(Math.random() * 100)}`];
      return names.map((name, i) => ({
        id: `${type.toLowerCase()}_${i}`,
        name,
        price: (Math.random() * 3 + 1).toFixed(2)
        // Removed image property
      }));
    }

    // =================== Page Components ===================
    function renderHomePage() {
      const c = document.getElementById('content');
      const header = document.createElement('h1');
      header.innerText = 'Welcome to Candy Cartel!';
      header.style.textAlign = 'center';
      header.style.marginBottom = '20px';
      header.style.fontFamily = "'Brush Script MT', cursive";
      header.style.color = '#ff6f61';
      c.appendChild(header);

      const mapDiv = document.createElement('div');
      mapDiv.id = 'map';
      mapDiv.style.width = '100%';
      mapDiv.style.height = '400px';
      mapDiv.style.borderRadius = '8px';
      mapDiv.style.overflow = 'hidden';
      c.appendChild(mapDiv);

      const contactDiv = document.createElement('div');
      contactDiv.style.display = 'flex';
      contactDiv.style.justifyContent = 'space-around';
      contactDiv.style.marginTop = '30px';

      const contacts = [
        {title: 'Phone', info: '+1 234 567 8901'},
        {title: 'Email', info: 'info@candycartel.com'},
        {title: 'Message', info: 'Visit us for sweet treats!'}
      ];

      contacts.forEach(cItem => {
        const box = document.createElement('div');
        box.style.background = '#fff';
        box.style.padding = '15px';
        box.style.borderRadius = '8px';
        box.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
        box.style.minWidth = '200px';

        const title = document.createElement('h3');
        title.innerText = cItem.title;
        title.style.color = '#ff6f61';

        const info = document.createElement('p');
        info.innerText = cItem.info;

        box.appendChild(title);
        box.appendChild(info);
        contactDiv.appendChild(box);
      });
      c.appendChild(contactDiv);
    }

    function renderProductsPage(title, products) {
      const c = document.getElementById('content');
      const h2 = document.createElement('h2');
      h2.className = 'page-title';
      h2.innerText = title;
      c.appendChild(h2);
      const grid = document.createElement('div');
      grid.className = 'products-grid';
      products.forEach(p => {
        const card = document.createElement('div');
        card.className = 'product-card';

        // Removed image creation
        // const img = document.createElement('img');
        // img.src = p.image; // No longer used
        // img.className = 'product-image';
        // card.appendChild(img);

        const pname = document.createElement('div');
        pname.className = 'product-name';
        pname.innerText = p.name;
        const pprice = document.createElement('div');
        pprice.className = 'product-price';
        pprice.innerText = '$' + p.price;
        const btn = document.createElement('button');
        btn.className = 'add-cart-btn';
        btn.innerText = 'Add to Cart';
        btn.onclick = () => addToCart({id: p.id, name: p.name, price: parseFloat(p.price), quantity: 1});
        card.appendChild(pname);
        card.appendChild(pprice);
        card.appendChild(btn);
        grid.appendChild(card);
      });
      c.appendChild(grid);
    }

    function renderCartPage() {
      const c = document.getElementById('content');
      c.innerHTML = '';
      const h2 = document.createElement('h2');
      h2.className = 'page-title';
      h2.innerText = 'Your Cart';
      c.appendChild(h2);
      if (cart.length === 0) {
        const msg = document.createElement('p');
        msg.innerText = 'Your cart is empty.';
        msg.style.textAlign = 'center';
        msg.style.fontSize = '1.2em';
        c.appendChild(msg);
        return;
      }
      const table = document.createElement('table');
      table.id = 'cart-table';
      const headerRow = document.createElement('tr');
      ['Item', 'Price', 'Quantity', 'Total', 'Remove'].forEach(t => {
        const th = document.createElement('th');
        th.innerText = t;
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);
      let total = 0;
      cart.forEach((i, iIdx) => {
        const row = document.createElement('tr');
        const itemTd = document.createElement('td');
        itemTd.innerText = i.name;
        const priceTd = document.createElement('td');
        priceTd.innerText = '$' + i.price;
        const qtyTd = document.createElement('td');
        const qtyInput = document.createElement('input');
        qtyInput.type = 'number';
        qtyInput.min = 1;
        qtyInput.max = MAX_ITEMS;
        qtyInput.value = i.quantity;
        qtyInput.style.width = '60px';
        qtyInput.onchange = () => {
          const val = parseInt(qtyInput.value);
          if (isNaN(val) || val < 1) { qtyInput.value = i.quantity; return; }
          i.quantity = val;
          saveCart();
          updateCartBadge();
          renderCartPage();
        };
        qtyTd.appendChild(qtyInput);
        const totalTd = document.createElement('td');
        const totalPrice = (i.price * i.quantity);
        totalTd.innerText = '$' + totalPrice.toFixed(2);
        total += totalPrice;
        const removeTd = document.createElement('td');
        const remBtn = document.createElement('button');
        remBtn.innerText = 'Remove';
        remBtn.onclick = () => {
          cart.splice(iIdx, 1);
          saveCart();
          updateCartBadge();
          renderCartPage();
        };
        removeTd.appendChild(remBtn);
        row.appendChild(itemTd);
        row.appendChild(priceTd);
        row.appendChild(qtyTd);
        row.appendChild(totalTd);
        row.appendChild(removeTd);
        table.appendChild(row);
      });
      const totalRow = document.createElement('tr');
      totalRow.className = 'total-row';
      const totalLabelTd = document.createElement('td');
      totalLabelTd.colSpan = 3;
      totalLabelTd.innerText = 'Total';
      const totalAmountTd = document.createElement('td');
      totalAmountTd.innerText = '$' + cart.reduce((sum, i) => sum + i.price * i.quantity, 0).toFixed(2);
      const emptyTd = document.createElement('td');
      totalRow.appendChild(totalLabelTd);
      totalRow.appendChild(totalAmountTd);
      totalRow.appendChild(emptyTd);
      table.appendChild(totalRow);
      c.appendChild(table);
      const btn = document.createElement('button');
      btn.id = 'checkout-btn';
      btn.innerText = 'Checkout';
      btn.onclick = () => render('checkout');
      c.appendChild(btn);
    }

    function renderCheckoutPage() {
      const c = document.getElementById('content');
      c.innerHTML = '';
      const h2 = document.createElement('h2');
      h2.className = 'page-title';
      h2.innerText = 'Checkout';
      c.appendChild(h2);
      if (cart.length === 0) {
        const msg = document.createElement('p');
        msg.innerText = 'Your cart is empty.';
        msg.style.textAlign = 'center';
        msg.style.fontSize = '1.2em';
        c.appendChild(msg);
        return;
      }
      const form = document.createElement('form');
      form.style.maxWidth = '600px';
      form.style.margin = '0 auto';

      function createLabelInput(labelText, type = 'text') {
        const label = document.createElement('label');
        label.innerText = labelText;
        const input = document.createElement('input');
        input.type = type;
        input.required = true;
        label.appendChild(input);
        return label;
      }
      
      const firstNameLabel = createLabelInput('First Name:');
      const lastNameLabel = createLabelInput('Last Name:');
      const emailLabel = createLabelInput('Email:', 'email');
      const addressLabel = createLabelInput('Address:');
      const cardLabel = createLabelInput('Card Number:');
      const expiryLabel = createLabelInput('Expiry Date (MM/YY):');
      const secLabel = createLabelInput('Security Code:');

      [firstNameLabel, lastNameLabel, emailLabel, addressLabel, cardLabel, expiryLabel, secLabel].forEach(lbl => {
        form.appendChild(lbl);
        form.appendChild(document.createElement('br'));
      });

      const payBtn = document.createElement('button');
      payBtn.type = 'submit';
      payBtn.innerText = 'Pay';
      form.appendChild(payBtn);

      form.onsubmit = (e) => {
        e.preventDefault();
        alert('Order confirmed! Thank you.');
        cart = [];
        saveCart();
        updateCartBadge();
        render('home');
      };
      document.getElementById('content').appendChild(form);
    }

    function renderContactPage() {
      const c = document.getElementById('content');
      c.innerHTML = '';
      const h2 = document.createElement('h2');
      h2.className = 'page-title';
      h2.innerText = 'Contact Us';
      c.appendChild(h2);
      
      const form = document.createElement('form');
      form.style.maxWidth = '600px';
      form.style.margin = '20px auto';

      const nameLbl = document.createElement('label');
      nameLbl.innerText = 'Name:';
      const nameInput = document.createElement('input');
      nameInput.type = 'text';
      nameInput.required = true;
      nameLbl.appendChild(nameInput);
      form.appendChild(nameLbl);
      form.appendChild(document.createElement('br'));

      const emailLbl = document.createElement('label');
      emailLbl.innerText = 'Email:';
      const emailInput = document.createElement('input');
      emailInput.type = 'email';
      emailInput.required = true;
      emailLbl.appendChild(emailInput);
      form.appendChild(emailLbl);
      form.appendChild(document.createElement('br'));

      const msgLbl = document.createElement('label');
      msgLbl.innerText = 'Message:';
      const msgInput = document.createElement('textarea');
      msgInput.required = true;
      msgLbl.appendChild(msgInput);
      form.appendChild(msgLbl);
      form.appendChild(document.createElement('br'));

      const sendBtn = document.createElement('button');
      sendBtn.type = 'submit';
      sendBtn.innerText = 'Send Message';
      form.appendChild(sendBtn);

      form.onsubmit = (e) => {
        e.preventDefault();
        alert('Message sent! We will get back to you.');
        form.reset();
      };
      c.appendChild(form);
    }

    function renderReviewPage() {
      const c = document.getElementById('content');
      c.innerHTML = '';

      const h2 = document.createElement('h2');
      h2.className = 'page-title';
      h2.innerText = 'Leave a Review';
      c.appendChild(h2);
      
      const starDiv = document.createElement('div');
      starDiv.id = 'review-stars';
      let selectedStars = 0;
      const starsArr = [];
      for (let i = 1; i <= 5; i++) {
        const star = document.createElement('span');
        star.className = 'star';
        star.innerHTML = '&#9733;';
        star.dataset.value = i;
        star.onclick = () => { selectedStars = i; updateStars(); };
        starsArr.push(star);
        starDiv.appendChild(star);
      }
      function updateStars() {
        starsArr.forEach((s, i) => s.className = 'star' + (i + 1 <= selectedStars ? ' filled' : ''));
      }
      c.appendChild(starDiv);

      const reviewTextarea = document.createElement('textarea');
      reviewTextarea.id = 'review-textarea';
      reviewTextarea.placeholder = 'Write your review here...';
      c.appendChild(reviewTextarea);
      
      const submitBtn = document.createElement('button');
      submitBtn.id = 'review-submit';
      submitBtn.innerText = 'Submit Review';
      submitBtn.onclick = () => {
        if (selectedStars === 0 || reviewTextarea.value.trim() === '') {
          alert('Choose stars and write a review!');
          return;
        }
        reviews.push({stars: selectedStars, text: reviewTextarea.value.trim(), date: new Date().toISOString()});
        saveReviews();
        alert('Thank you for your review!');
        selectedStars = 0;
        updateStars();
        reviewTextarea.value = '';
        renderAllReviews();
      };
      c.appendChild(submitBtn);
      renderAllReviews();

      function renderAllReviews() {
        let existing = document.getElementById('reviews-list');
        if (existing) existing.remove();
        const listDiv = document.createElement('div');
        listDiv.id = 'reviews-list';

        if (reviews.length === 0) {
          const noRev = document.createElement('p');
          noRev.innerText = 'No reviews yet.';
          noRev.style.textAlign = 'center';
          listDiv.appendChild(noRev);
        } else {
          reviews.slice().reverse().forEach(r => {
            const rDiv = document.createElement('div');
            rDiv.className = 'review-item';

            const headerDiv = document.createElement('div');
            headerDiv.className = 'review-header';

            const starsSpan = document.createElement('span');
            starsSpan.className = 'review-stars';
            starsSpan.innerHTML = '&#9733;'.repeat(r.stars) + '&#9734;'.repeat(5 - r.stars);

            const dateSpan = document.createElement('span');
            dateSpan.className = 'review-date';
            dateSpan.innerText = new Date(r.date).toLocaleString();

            headerDiv.appendChild(starsSpan);
            headerDiv.appendChild(dateSpan);

            const txtP = document.createElement('p');
            txtP.innerText = r.text;

            rDiv.appendChild(headerDiv);
            rDiv.appendChild(txtP);
            listDiv.appendChild(rDiv);
          });
        }
        document.getElementById('content').appendChild(listDiv);
      }
    }

    // =================== Event Listeners & Cart Management ===================
    document.querySelectorAll('.nav-buttons a').forEach(l => {
      l.onclick = e => { e.preventDefault(); render(e.target.dataset.page); };
    });

    document.getElementById('cart-btn').onclick = () => render('cart');

    function addToCart(item) {
      const existing = cart.find(i => i.id === item.id);
      if (existing) {
        existing.quantity += 1;
      } else {
        if (cart.reduce((sum, i) => sum + i.quantity, 0) >= MAX_ITEMS) {
          alert('Cart is full!');
          return;
        }
        item.quantity = 1;
        cart.push(item);
      }
      saveCart();
      updateCartBadge();
      showNotification(`Added ${item.name}`);
    }

    // Initial render
    window.onload = () => {
      loadCart();
      updateCartBadge();
      render(currentPage);
    };
  </script>
</body>
</html>
